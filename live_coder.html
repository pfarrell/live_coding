<!doctype html>
<html>
  <head>
    <style>
      html, body { overflow: hidden; display: inline;}
      textarea { width: 90%; height: 75vh; display: inline; }
      .row {display: flex; grid-auto-flow: column; }
      .col {flex-basis: 50%;}
      .dot {height: 25px; width: 25px; border-radius: 50%; display: inline-block; background-color: 'red';}
      #log { font-family: "Lucida Console", "Courier New", monospace; font-size: 0.875em; }
    </style>
    <script src="lib/codemirror.js"></script>
    <link rel="stylesheet" href="lib/codemirror.css">
    <script src="lib/mode/javascript/javascript.js"></script>
    <script>
    </script>
</script>
  </head>
  <body>
    <div class="row">
      <div class="col"><canvas id="view"></canvas></div>
      <div class="col">
        <textarea rows=50 id="code"></textarea>
        <p id="log"></p>
      </div>
    </div>

  </body>
  <script language="JavaScript">
    var textarea = document.getElementById('code');
    var myCodeMirror = CodeMirror.fromTextArea(textarea, {
          "mode": "javascript",
          "lineNumbers": true,
          "tabSize": 4,
          "smartIndent": true,
        });

    myCodeMirror.on("change", draw);

    function log(text) {
      document.getElementById("log").innerHTML = text.replace(/\n\r?/g, '<br/>');
    }

    function working(isWorking) {
      var color = isWorking ? "green" : "red";
      return '<span class="dot ' + color + '"></span>' 
    }

    function draw() {
      var code = myCodeMirror.getValue();
      try {
        log(working(true));
        eval(code);
        last_working_code = code;
      }catch(error) {
        log("<div>" + working(false) + " line " + error.lineNumber+ ": " + error + "</div>");
        eval(last_working_code);
      }
    }

    var canvas = document.querySelector('canvas');
    var ctx = canvas.getContext('2d');
    var last_working_code;
    canvas.height=750;
    canvas.width=window.innerWidth/100*45;
    draw();

    //setInterval(draw, 50);
  </script>
</html>
